var f=Object.defineProperty;var g=(e,t,s)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var r=(e,t,s)=>g(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const m=[{description:"Выживший нашёл заброшенный дом и обнаружил немного еды.",effect:(e,t)=>{e.updateResources(5,0,0,0)}},{description:"Выживший встретил дружелюбного торговца и обменял воду на материалы.",effect:(e,t)=>{e.updateResources(0,-5,10,0)}},{description:"Выживший наткнулся на опасную ловушку и был ранен.",effect:(e,t)=>{e.updateResources(0,0,0,-10)}},{description:"Выживший обнаружил источник чистой воды.",effect:(e,t)=>{e.updateResources(0,10,0,0)}},{description:"Выживший нашёл запасы материалов в старом складе.",effect:(e,t)=>{e.updateResources(0,0,10,0)}},{description:"Выживший спас потерявшегося человека, который присоединился к колонии.",effect:(e,t)=>{e.survivors.push(new l(`Выживший ${e.survivors.length+1}`)),e.updateResources(0,0,0,5)}},{description:"Выживший потерялся и вернулся позже, чем ожидалось.",effect:(e,t)=>{}},{description:"Выживший нашёл лекарственные растения.",effect:(e,t)=>{e.updateResources(0,0,0,10)}},{description:"Выживший обнаружил безопасный путь для будущих миссий.",effect:(e,t)=>{}},{description:"Выживший был атакован дикими животными и потерял часть собранных ресурсов.",effect:(e,t)=>{e.updateResources(-5,-5,-5,-5)}},{description:"Выживший нашёл карту местности, облегчающую будущие путешествия.",effect:(e,t)=>{}},{description:"Выживший обнаружил редкий артефакт, поднимающий мораль колонии.",effect:(e,t)=>{e.updateResources(0,0,0,15)}},{description:"Выживший попал в радиоактивную зону и почувствовал недомогание.",effect:(e,t)=>{e.updateResources(0,0,0,-10)}},{description:"Выживший встретил враждебных выживших и был вынужден отступить.",effect:(e,t)=>{e.updateResources(0,0,0,-5)}},{description:"Выживший нашёл брошенный транспорт и привёз дополнительные материалы.",effect:(e,t)=>{e.updateResources(0,0,15,0)}},{description:"Выживший обнаружил оазис с большим запасом воды.",effect:(e,t)=>{e.updateResources(0,20,0,0)}},{description:"Выживший нашёл консервированные продукты в подвале здания.",effect:(e,t)=>{e.updateResources(15,0,0,0)}},{description:"Выживший был ограблен бандитами и вернулся без ресурсов.",effect:(e,t)=>{e.updateResources(-10,-10,-10,-10)}},{description:"Выживший обнаружил склад боеприпасов.",effect:(e,t)=>{e.updateResources(0,0,10,5)}},{description:"Выживший помог раненому путнику, который поделился едой.",effect:(e,t)=>{e.updateResources(10,0,0,5)}},{description:"Выживший нашёл старую библиотеку и принёс полезные знания.",effect:(e,t)=>{e.updateResources(0,0,0,10)}},{description:"Выживший обнаружил ловушку и обезвредил её, получив материалы.",effect:(e,t)=>{e.updateResources(0,0,5,0)}},{description:"Выживший встретил старого знакомого, который помог с ресурсами.",effect:(e,t)=>{e.updateResources(5,5,5,5)}},{description:"Выживший попал под дождь и заболел.",effect:(e,t)=>{e.updateResources(0,0,0,-5)}},{description:"Выживший нашёл запасы топлива, полезного для колонии.",effect:(e,t)=>{e.updateResources(0,0,10,0)}},{description:"Выживший обнаружил заброшенный лагерь с припасами.",effect:(e,t)=>{e.updateResources(10,10,10,0)}},{description:"Выживший попал в песчаную бурю и задержался в пути.",effect:(e,t)=>{}},{description:"Выживший нашёл инструменты для улучшения базы.",effect:(e,t)=>{e.updateResources(0,0,5,5)}},{description:"Выживший обменял ненужные вещи на еду.",effect:(e,t)=>{e.updateResources(10,0,-5,0)}},{description:"Выживший обнаружил склад медикаментов.",effect:(e,t)=>{e.updateResources(0,0,0,15)}},{description:"Выживший встретил группу путешественников и обменялся информацией.",effect:(e,t)=>{e.updateResources(0,0,0,5)}},{description:"Выживший нашёл редкие ресурсы, повышающие мораль.",effect:(e,t)=>{e.updateResources(0,0,0,10)}},{description:"Выживший был атакован мутантами и с трудом выбрался.",effect:(e,t)=>{e.updateResources(0,0,0,-15)}},{description:"Выживший обнаружил запасы семян для выращивания растений.",effect:(e,t)=>{e.updateResources(0,0,0,5)}},{description:"Выживший помог местным жителям и получил взамен воду.",effect:(e,t)=>{e.updateResources(0,15,0,5)}},{description:"Выживший нашёл работающую радиостанцию и передал полезную информацию.",effect:(e,t)=>{e.updateResources(0,0,0,10)}},{description:"Выживший обнаружил минное поле и с трудом его обошёл.",effect:(e,t)=>{e.updateResources(0,0,0,-5)}},{description:"Выживший нашёл редкий металл для улучшения оружия.",effect:(e,t)=>{e.updateResources(0,0,10,0)}},{description:"Выживший встретил учёного, поделившегося знаниями.",effect:(e,t)=>{e.updateResources(0,0,0,10)}},{description:"Выживший заблудился и потратил дополнительные ресурсы.",effect:(e,t)=>{e.updateResources(-5,-5,0,-5)}},{description:"Выживший нашёл место с плодородной землёй.",effect:(e,t)=>{e.updateResources(0,0,0,5)}},{description:"Выживший помог отбиться от мутантов, получив благодарность местных.",effect:(e,t)=>{e.updateResources(0,0,0,10)}},{description:"Выживший обнаружил склад с запчастями.",effect:(e,t)=>{e.updateResources(0,0,10,0)}},{description:"Выживший попал под радиационный дождь и вернулся больным.",effect:(e,t)=>{e.updateResources(0,0,0,-10)}},{description:"Выживший нашёл заброшенный бункер с ресурсами.",effect:(e,t)=>{e.updateResources(15,15,15,0)}},{description:"Выживший обнаружил неисправный дрон и починил его.",effect:(e,t)=>{e.updateResources(0,0,0,10)}},{description:"Выживший обменял информацию на ресурсы.",effect:(e,t)=>{e.updateResources(5,5,5,0)}},{description:"Выживший встретил агрессивных выживших и избежал конфликта.",effect:(e,t)=>{e.updateResources(0,0,0,-5)}},{description:"Выживший нашёл запасные части для генератора.",effect:(e,t)=>{e.updateResources(0,0,5,5)}},{description:"Выживший обнаружил тайник с едой и водой.",effect:(e,t)=>{e.updateResources(10,10,0,0)}}];class l{constructor(t){r(this,"name");r(this,"isOnMission",!1);r(this,"missionType",null);r(this,"timeLeft");r(this,"pendingEvent",null);r(this,"totalExpeditions",0);this.name=t}startMission(t,s){this.isOnMission=!0,this.missionType=t,this.timeLeft=this.getMissionDuration(s),this.totalExpeditions+=1}updateTimer(t){this.timeLeft!==void 0&&(this.timeLeft-=t)}getMissionDuration(t){return t+this.totalExpeditions}resetTimer(){this.isOnMission&&this.timeLeft!==void 0&&(this.timeLeft=0)}completeMission(t){this.isOnMission=!1,Math.random()<.5?this.triggerMissionEvent():this.collectResources(t)}triggerMissionEvent(){const t=Math.floor(Math.random()*m.length),s=m[t];this.pendingEvent=s}collectResources(t){const s=Math.floor(Math.random()*10)+1;let n="";switch(this.missionType){case"food":t.updateResources(s,0,0,0),n=`Выживший ${this.name} нашёл ${s} единиц еды.`;break;case"water":t.updateResources(0,s,0,0),n=`Выживший ${this.name} нашёл ${s} единиц воды.`;break;case"materials":t.updateResources(0,0,s,0),n=`Выживший ${this.name} нашёл ${s} единиц материалов.`;break}this.pendingEvent={description:n,effect:(i,o)=>{o.pendingEvent=null}}}resolvePendingEvent(t){this.pendingEvent&&(this.pendingEvent.effect(t,this),this.pendingEvent=null)}}class y{constructor(){r(this,"food");r(this,"water");r(this,"materials");r(this,"morale");r(this,"technologies");r(this,"survivors");this.food=50,this.water=50,this.materials=30,this.morale=100,this.technologies=new Set,this.survivors=[new l("Выживший 1"),new l("Выживший 2"),new l("Выживший 3")]}updateResources(t,s,n,i,o=0){this.food+=t,this.water+=s,this.materials+=n,this.morale+=i,this.food=Math.max(this.food,0),this.water=Math.max(this.water,0),this.materials=Math.max(this.materials,0),this.morale=Math.min(Math.max(this.morale,0),100)}researchTechnology(t){this.materials>=t.cost&&(this.materials-=t.cost,t.effect(this),this.technologies.add(t.name))}}class M{constructor(t){r(this,"currentDay");r(this,"maxDays");this.currentDay=1,this.maxDays=t}nextDay(){this.currentDay++}isGameOver(){return this.currentDay>this.maxDays}}class R{constructor(t,s,n,i){r(this,"survivorElements",[]);this.player=t,this.onStartMission=s,this.onResetTimer=n,this.onResolveMissionEvent=i}render(){const t=document.createElement("div");t.id="survivors",t.classList.add("mb-4");const s=document.createElement("h2");return s.textContent="Выжившие",t.appendChild(s),this.survivorElements=[],this.player.survivors.forEach((n,i)=>{const o=document.createElement("div");o.className="survivor card mb-3",o.style.width="100%";const a=document.createElement("div");a.className="card-body";const c=document.createElement("h5");c.className="card-title",c.textContent=n.name,a.appendChild(c);const u=document.createElement("p");if(u.className="card-text",n.isOnMission){u.innerHTML=`
          На задании (<strong>${n.missionType}</strong>), вернется через <span id="timer-${i}">${Math.ceil(n.timeLeft||0)}</span> сек.
        `,a.appendChild(u);const d=document.createElement("button");d.className="btn btn-warning",d.textContent="Сбросить таймер (донат)",d.onclick=()=>{this.onResetTimer(i),alert("Таймер сброшен после покупки!")},a.appendChild(d)}else if(n.pendingEvent){u.innerHTML=`
          Вернулся из задания.<br><em>${n.pendingEvent.description}</em>
        `,a.appendChild(u);const d=document.createElement("button");d.className="btn btn-primary",d.textContent="OK",d.onclick=()=>{this.onResolveMissionEvent(i)},a.appendChild(d)}else{u.textContent="Доступен для задания.",a.appendChild(u);const d=document.createElement("div");d.className="btn-group";const p=document.createElement("button");p.className="btn btn-success",p.textContent="Собирать еду",p.onclick=()=>{this.onStartMission(i,"food")},d.appendChild(p);const h=document.createElement("button");h.className="btn btn-info",h.textContent="Собирать воду",h.onclick=()=>{this.onStartMission(i,"water")},d.appendChild(h);const v=document.createElement("button");v.className="btn btn-secondary",v.textContent="Собирать материалы",v.onclick=()=>{this.onStartMission(i,"materials")},d.appendChild(v),a.appendChild(d)}o.appendChild(a),this.survivorElements[i]=o,t.appendChild(o)}),t}updateTimers(){this.player.survivors.forEach((t,s)=>{if(t.isOnMission&&t.timeLeft!==void 0){const n=document.getElementById(`timer-${s}`);n&&(n.textContent=`${Math.ceil(t.timeLeft)}`)}})}}const E=[{name:"Агрокультура",description:"Увеличивает производство еды на 20%",cost:50,effect:e=>{}},{name:"Водоснабжение",description:"Увеличивает производство воды на 20%",cost:50,effect:e=>{}},{name:"Медицина",description:"Снижает вероятность негативных событий",cost:40,effect:e=>{}},{name:"Оружие",description:"Повышает защиту колонии",cost:60,effect:e=>{}}];class b{constructor(t,s){r(this,"techContainer");this.player=t,this.updateStats=s,this.techContainer=document.createElement("div")}render(){this.techContainer.innerHTML="",this.techContainer.id="technologies",this.techContainer.classList.add("mb-4");const t=document.createElement("h2");return t.textContent="Технологии",this.techContainer.appendChild(t),E.forEach(s=>{const n=document.createElement("div");n.className="card mb-2";const i=document.createElement("div");i.className="card-body";const o=document.createElement("h5");o.className="card-title",o.textContent=s.name,i.appendChild(o);const a=document.createElement("p");if(a.className="card-text",a.textContent=s.description,i.appendChild(a),this.player.technologies.has(s.name)){const c=document.createElement("span");c.className="badge badge-success",c.textContent="Изучено",i.appendChild(c)}else{const c=document.createElement("button");c.className="btn btn-success",c.textContent=`Исследовать (Стоимость: ${s.cost})`,c.addEventListener("click",()=>{this.player.materials>=s.cost?(this.player.researchTechnology(s),this.updateStats(),this.updateView()):alert("Недостаточно материалов для исследования этой технологии.")}),i.appendChild(c)}n.appendChild(i),this.techContainer.appendChild(n)}),this.techContainer}updateView(){this.render()}}class C{constructor(t,s,n){r(this,"onStartMissionCallback",()=>{});r(this,"onNextDayCallback",()=>{});r(this,"onResetTimerCallback",()=>{});r(this,"onResolveMissionEventCallback",()=>{});r(this,"currentView","survivors");r(this,"survivorView");r(this,"technologyView");this.container=t,this.player=s,this.dayManager=n,this.survivorView=new R(this.player,(i,o)=>this.onStartMissionCallback(i,o),i=>this.onResetTimerCallback(i),i=>this.onResolveMissionEventCallback(i)),this.technologyView=new b(this.player,()=>this.updateStats())}render(){if(this.renderHeader(),this.container.innerHTML="",this.renderStats(),this.currentView==="survivors"){const t=this.survivorView.render();this.container.appendChild(t)}else if(this.currentView==="technologies"){const t=this.technologyView.render();this.container.appendChild(t)}this.renderBottomMenu()}renderHeader(){const t=document.getElementById("header-container");if(t){t.innerHTML="";const s=document.createElement("div");s.className="d-flex justify-content-between align-items-center";const n=document.createElement("h1");n.textContent=`День ${this.dayManager.currentDay}`,n.classList.add("mb-0"),s.appendChild(n);const i=document.createElement("button");i.className="btn btn-primary",i.textContent="Следующий день",i.addEventListener("click",()=>{this.onNextDayCallback()}),s.appendChild(i),t.appendChild(s)}else console.error("Header container not found")}renderStats(){const t=document.createElement("div");t.id="stats",t.classList.add("mb-4"),t.innerHTML=`
      <div class="row">
        <div class="col-md-2"><strong>Еда:</strong> ${Math.floor(this.player.food)}</div>
        <div class="col-md-2"><strong>Вода:</strong> ${Math.floor(this.player.water)}</div>
        <div class="col-md-2"><strong>Материалы:</strong> ${this.player.materials}</div>
        <div class="col-md-2"><strong>Мораль:</strong> ${this.player.morale}</div>
        <div class="col-md-2"><strong>Выжившие:</strong> ${this.player.survivors.length}</div>
      </div>
    `,this.container.appendChild(t)}renderBottomMenu(){var n,i;const t=document.getElementById("bottom-menu");t&&t.remove();const s=document.createElement("nav");s.id="bottom-menu",s.className="navbar fixed-bottom navbar-light bg-light",s.innerHTML=`
    <div class="container-fluid justify-content-around">
      <button id="menu-survivors" class="btn btn-outline-primary btn-lg">Выжившие</button>
      <button id="menu-technologies" class="btn btn-outline-secondary btn-lg">Технологии</button>
    </div>
  `,document.body.appendChild(s),(n=document.getElementById("menu-survivors"))==null||n.addEventListener("click",()=>{this.currentView="survivors",this.render()}),(i=document.getElementById("menu-technologies"))==null||i.addEventListener("click",()=>{this.currentView="technologies",this.render()})}updateStats(){const t=document.getElementById("stats");t&&(t.innerHTML=`
        <div class="row">
          <div class="col-md-2"><strong>Еда:</strong> ${Math.floor(this.player.food)}</div>
          <div class="col-md-2"><strong>Вода:</strong> ${Math.floor(this.player.water)}</div>
          <div class="col-md-2"><strong>Материалы:</strong> ${this.player.materials}</div>
          <div class="col-md-2"><strong>Мораль:</strong> ${this.player.morale}</div>
          <div class="col-md-2"><strong>Выжившие:</strong> ${this.player.survivors.length}</div>
        </div>
      `)}updateSurvivorTimers(){this.currentView==="survivors"&&this.survivorView.updateTimers()}onStartMission(t){this.onStartMissionCallback=t}onNextDay(t){this.onNextDayCallback=t}onResetTimer(t){this.onResetTimerCallback=t}onResolveMissionEvent(t){this.onResolveMissionEventCallback=t}showEvent(t,s,n,i,o){var c,u;const a=document.createElement("div");a.id="event",a.className="modal show",a.style.display="block",a.innerHTML=`
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Событие</h5>
          </div>
          <div class="modal-body">
            <p>${t}</p>
          </div>
          <div class="modal-footer">
            <button id="optionA" class="btn btn-primary">${s}</button>
            <button id="optionB" class="btn btn-secondary">${n}</button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(a),(c=document.getElementById("optionA"))==null||c.addEventListener("click",()=>{i(),document.body.removeChild(a),this.render()}),(u=document.getElementById("optionB"))==null||u.addEventListener("click",()=>{o(),document.body.removeChild(a),this.render()})}showGameOver(t){this.container.innerHTML='<h1 class="my-4">Игра окончена!</h1>';const s=document.createElement("div");s.innerHTML=`
      <p>Итоговые результаты:</p>
      <ul>
        <li>Еда: ${Math.floor(t.food)}</li>
        <li>Вода: ${Math.floor(t.water)}</li>
        <li>Материалы: ${t.materials}</li>
        <li>Мораль: ${t.morale}</li>
        <li>Выжившие: ${t.survivors.length}</li>
      </ul>
    `,this.container.appendChild(s)}}const x=[{day:1,description:"Вы обнаружили заброшенный склад рядом с базой. Исследовать его?",optionA:{text:"Да, исследовать",effect:e=>{e.updateResources(10,10,15,5)}},optionB:{text:"Нет, это может быть опасно",effect:e=>{e.updateResources(0,0,0,-5)}}},{day:2,description:"К базе подошла группа выживших. Принять их?",optionA:{text:"Принять (+2 выживших, -10 еды, -10 воды)",effect:e=>{e.updateResources(-10,-10,0,10),e.survivors.push(new l(`Выживший ${e.survivors.length+1}`)),e.survivors.push(new l(`Выживший ${e.survivors.length+1}`))}},optionB:{text:"Отказать (сохранить ресурсы)",effect:e=>{e.updateResources(0,0,0,-10)}}},{day:3,description:"Ваша колония обнаружила залежи металла. Начать добычу?",optionA:{text:"Да, начать добычу (-10 еды, +30 материалов)",effect:e=>{e.updateResources(-10,0,30,5)}},optionB:{text:"Нет, это слишком рискованно",effect:e=>{e.updateResources(0,0,0,-5)}}},{day:4,description:"В колонии вспыхнула болезнь. Как поступить?",optionA:{text:"Использовать лекарства (-15 материалов, мораль +10)",effect:e=>{e.updateResources(0,0,-15,10)}},optionB:{text:"Объявить карантин (производительность снижается)",effect:e=>{e.updateResources(0,0,0,-10)}}},{day:5,description:"Вы обнаружили источник чистой воды. Построить там колодец?",optionA:{text:"Да, построить (-20 материалов, +30 воды)",effect:e=>{e.updateResources(0,30,-20,5)}},optionB:{text:"Нет, ресурсов не хватает",effect:e=>{e.updateResources(0,0,0,-5)}}},{day:6,description:"К базе приблизилась банда мародеров. Как действовать?",optionA:{text:"Откупиться (-20 еды, -20 воды, мораль -10)",effect:e=>{e.updateResources(-20,-20,0,-10)}},optionB:{text:"Сражаться (риск потерять выживших)",effect:e=>{Math.random()<.5?(e.updateResources(0,0,0,-20),e.survivors.pop()):e.updateResources(0,0,0,10)}}},{day:7,description:"Найдены старые книги с технологиями. Изучить их?",optionA:{text:"Да, изучить (+1 технология)",effect:e=>{const s=["Агрокультура","Водоснабжение","Медицина","Оружие"].find(n=>!e.technologies.has(n));s?(e.technologies.add(s),e.updateResources(0,0,0,10)):e.updateResources(0,0,0,5)}},optionB:{text:"Нет, времени нет",effect:e=>{e.updateResources(0,0,0,-5)}}},{day:8,description:"Произошла сильная буря, часть построек разрушена. Ремонтировать?",optionA:{text:"Да, ремонтировать (-20 материалов)",effect:e=>{e.updateResources(0,0,-20,5)}},optionB:{text:"Нет, оставить как есть (мораль -15)",effect:e=>{e.updateResources(0,0,0,-15)}}},{day:9,description:"К вам пришли торговцы, предлагают обмен ресурсов. Обменять?",optionA:{text:"Обменять 10 материалов на 20 еды",effect:e=>{e.materials>=10?e.updateResources(20,0,-10,5):e.updateResources(0,0,0,-5)}},optionB:{text:"Отказаться",effect:e=>{e.updateResources(0,0,0,-5)}}},{day:10,description:"Один из выживших предлагает рискованную вылазку за ресурсами. Позволить?",optionA:{text:"Да, пусть идет (риск потери выжившего, но возможны бонусы)",effect:e=>{Math.random()<.5?e.updateResources(20,20,20,10):(e.updateResources(0,0,0,-10),e.survivors.pop())}},optionB:{text:"Нет, это слишком опасно",effect:e=>{e.updateResources(0,0,0,-5)}}},{day:11,description:"Обнаружены следы диких животных. Организовать охоту?",optionA:{text:"Да, организовать (+30 еды, мораль +10)",effect:e=>{e.updateResources(30,0,0,10)}},optionB:{text:"Нет, это опасно",effect:e=>{e.updateResources(0,0,0,-5)}}},{day:12,description:"Приближается ядовитый туман. Как защититься?",optionA:{text:"Укрепить убежище (-15 материалов, мораль +5)",effect:e=>{e.updateResources(0,0,-15,5)}},optionB:{text:"Игнорировать (риск потери ресурсов)",effect:e=>{e.updateResources(-20,-20,0,-10)}}},{day:13,description:"В колонии назревает конфликт между выжившими. Разрешить?",optionA:{text:"Вмешаться и разрешить конфликт (мораль +10)",effect:e=>{e.updateResources(0,0,0,10)}},optionB:{text:"Оставить как есть (мораль -15)",effect:e=>{e.updateResources(0,0,0,-15)}}},{day:14,description:"Спасательная команда прибыла. Присоединиться к ним?",optionA:{text:"Да, эвакуироваться (конец игры)",effect:e=>{e.updateResources(0,0,0,20)}},optionB:{text:"Нет, остаться и продолжить борьбу",effect:e=>{e.updateResources(0,0,0,10)}}}];class w{constructor(t,s,n){this.player=t,this.uiManager=s,this.dayManager=n}triggerDailyEvent(t){const s=x.find(n=>n.day===t);s&&this.uiManager.showEvent(s.description,s.optionA.text,s.optionB.text,()=>{s.optionA.effect(this.player),this.checkGameOver()},()=>{s.optionB.effect(this.player),this.checkGameOver()})}checkGameOver(){(this.player.morale<=0||this.player.survivors.length<=0)&&(this.uiManager.showGameOver(this.player),this.dayManager.currentDay=this.dayManager.maxDays+1)}}class L{constructor(t){r(this,"player");r(this,"dayManager");r(this,"uiManager");r(this,"eventSystem");r(this,"lastUpdateTime");this.container=t,this.player=new y,this.dayManager=new M(14),this.uiManager=new C(t,this.player,this.dayManager),this.eventSystem=new w(this.player,this.uiManager,this.dayManager),this.lastUpdateTime=Date.now()}start(){this.bindEvents(),this.uiManager.render(),this.gameLoop()}bindEvents(){this.uiManager.onStartMission((t,s)=>{const n=this.player.survivors[t],i=2+this.dayManager.currentDay;n.startMission(s,i),this.uiManager.render()}),this.uiManager.onNextDay(()=>{this.dayManager.isGameOver()?this.uiManager.showGameOver(this.player):(this.dayManager.nextDay(),this.player.updateResources(-5*this.player.survivors.length,-5*this.player.survivors.length,0,0,0),this.uiManager.render(),this.eventSystem.triggerDailyEvent(this.dayManager.currentDay))}),this.uiManager.onResetTimer(t=>{this.player.survivors[t].resetTimer(),this.uiManager.render()}),this.uiManager.onResolveMissionEvent(t=>{this.player.survivors[t].resolvePendingEvent(this.player),this.uiManager.render()})}gameLoop(){const t=()=>{const s=Date.now(),n=(s-this.lastUpdateTime)/1e3;this.lastUpdateTime=s;let i=!1;this.player.survivors.forEach(o=>{o.isOnMission&&(o.updateTimer(n),o.timeLeft!==void 0&&o.timeLeft<=0&&(o.timeLeft=0,o.completeMission(this.player),i=!0))}),i?this.uiManager.render():this.uiManager.updateSurvivorTimers(),requestAnimationFrame(t)};requestAnimationFrame(t)}}window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("game-container");e&&new L(e).start()});
